<!DOCTYPE html>
<html>

<head>
  <meta charset="utf-8" />
  <meta
    name="viewport"
    content="width=device-width initial-scale=1"
  />

  <title>Digital Ofrenda</title>

  <link
    rel="preconnect"
    href="https://fonts.googleapis.com"
  >
  <link
    rel="preconnect"
    href="https://fonts.gstatic.com"
    crossorigin
  >
  <link
    href="https://fonts.googleapis.com/css2?family=Jost:wght@100..900&display=swap"
    rel="stylesheet"
  >
  <link rel="stylesheet" href="https://use.typekit.net/qvx3vuo.css">
  <link
    rel="stylesheet"
    href="style.css"
  />

  <!--  DOMPurify cleans up HTML to prevent XSS attacks
  https://www.jsdelivr.com/package/npm/dompurify  -->
  <script src="https://cdn.jsdelivr.net/npm/dompurify@3.3.0/dist/purify.min.js"></script>

</head>

<body>
  <main>
    <!-- Header overlay on altar background -->
    <header>
      <h1>Digital Ofrenda</h1>
      <div class="header-decoration" style="background-image: url('assets/decoration.svg');"></div>
    </header>
    
    <section id="status">
      <p id="readyStatus">✅ MongoDB is Ready</p>
      <p id="notReadyStatus">❌ MongoDB is not connected. Please check your connection string in <code>.env</code> file.
      </p>
    </section>
    
    <button id="createButton">Dedicate an ofrenda</button>

    <!-- Altar display area -->
    <section id="contentArea"></section>

    <footer>
      Created by <a href="https://nsitu.ca">Harold Sikkema</a> in the context of
      Systems Design in the Interaction Design program at Sheridan College.
    </footer>
  </main>

  <!-- Form Dialog for Adding/Editing -->
  <dialog id="formDialog">
    <div class="modal-container">
      <div class="modal-header">
        <h2>Add someone to the ofrenda</h2>
        <p>Share the story of your loved one</p>
      </div>

      <div class="modal-body">
        <form
          id="myForm"
          method="dialog"
        >
          <!-- Hidden field to store ID for updates -->
          <input
            type="hidden"
            name="id"
            id="id"
          />

          <!-- Hidden field to store image data -->
          <input
            type="hidden"
            name="imageUrl"
            id="imageUrl"
          />

          <!-- Image upload section -->
          <fieldset class="upload-fieldset">
            <legend>Deceased Photo</legend>
            <div id="uploadArea">
              <img
                id="imagePreview"
                src="assets/photo.svg"
                alt="Image preview"
              />
              <div class="upload-controls">
                <input
                  type="file"
                  id="fileInput"
                  accept="image/*"
                  style="display:none"
                />
                <button
                  type="button"
                  id="browseButton"
                >Browse</button>
                <button
                  type="button"
                  id="removeImageButton"
                  style="display:none;"
                >Remove</button>
                <p id="uploadInstructions">or drag and drop an image here</p>
              </div>
            </div>
            <div
              id="noticeArea"
              style="display:none"
            ></div>
          </fieldset>

          <fieldset>
            <label for="name">Name</label>
            <input
              required
              type="text"
              name="name"
              id="name"
              placeholder="e.g. Lonja"
              autocomplete="off"
            />
            <small class="validation">Name is required</small>
          </fieldset>

          <fieldset>
            <label for="lastName">Last Name</label>
            <input
              required
              type="text"
              name="lastName"
              id="lastName"
              placeholder="e.g. Gómez"
              autocomplete="off"
            />
          </fieldset>

          <fieldset>
            <label for="birthDate">Birth Date</label>
            <input
              type="date"
              name="birthDate"
              id="birthDate"
            />
          </fieldset>

          <fieldset>
            <label for="deathDate">Death Date</label>
            <input
              type="date"
              name="deathDate"
              id="deathDate"
            />
          </fieldset>

          <fieldset>
            <label for="description">Description</label>
            <small>Provide a brief biography.</small>
            <textarea
              placeholder="Share memories and stories about your loved one..."
              required
              minlength="20"
              name="description"
              id="description"
              rows="6"
              cols="30"
            ></textarea>
            <small class="validation">Bio must be at least 20 characters.</small>
          </fieldset>
    
        </form>
      </div>

      <div class="modal-footer">
        <button
          type="button"
          class="save"
          id="saveButton"
        >Save</button>
        <button
          type="button"
          class="cancel"
          id="cancelButton"
        >Cancel</button>
      </div>
    </div>
  </dialog>

  <!-- Detail View Dialog -->
  <dialog id="detailDialog">
    <div class="detail-container" id="detailContent">
      <!-- Content will be dynamically inserted here -->
    </div>
  </dialog>

  <script
    src="script.js"
    type="module"
  ></script>

  <script src="upload.js"></script>

</body>

</html>